<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ú–æ–Ω–æ–ø–æ–ª—ñ—è ‚Äî –æ–±–ª—ñ–∫ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ</title>
<style>
* {
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #2c3e50;
    padding: 10px;
    margin: 0;
    min-height: 100vh;
}

h1, h2, h3 {
    text-align: center;
    margin-top: 0;
    word-wrap: break-word;
}

h1 {
    color: white;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    padding: 15px;
    font-size: 1.8em;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.container {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 1600px;
    margin: 0 auto;
}

.box {
    border: none;
    padding: 20px;
    background: rgba(255, 255, 255, 0.95);
    min-width: 320px;
    flex: 1;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.box-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 3px solid;
    border-radius: 0 0 10px 10px;
}

.box-header.streets { border-color: #4CAF50; }
.box-header.railroads { border-color: #795548; }
.box-header.utilities { border-color: #2196F3; }
.box-header.players { border-color: #FF9800; }
.box-header.cards { border-color: #9C27B0; }

.box-header-icon {
    font-size: 1.5em;
}

button {
    font-family: inherit;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    padding: 12px 20px;
    cursor: pointer;
    color: white;
    border-radius: 12px;
    margin: 5px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    font-size: 0.95em;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}

button:active {
    transform: translateY(0);
}

button.secondary {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
}

button.danger {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4);
}

button.success {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

button.warning {
    background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
}

button.small {
    padding: 8px 15px;
    font-size: 0.85em;
    width: auto;
}

select, input {
    font-family: inherit;
    color: #2c3e50;
    border: 2px solid #e0e0e0;
    padding: 12px 15px;
    border-radius: 12px;
    margin: 5px 0;
    width: 100%;
    background: white;
    font-size: 0.95em;
    transition: border-color 0.3s;
}

select:focus, input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.card {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border: none;
    background: white;
    padding: 25px;
    z-index: 1000;
    min-width: 90%;
    max-width: 600px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    border-radius: 25px;
    text-align: center;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translate(-50%, -40%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

.hidden { 
    display: none; 
}

.property-item {
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 15px;
    transition: all 0.3s ease;
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    border-left: 5px solid;
    position: relative;
    overflow: hidden;
}

.property-item:hover {
    transform: translateX(5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
}

.property-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--property-color), transparent);
}

.property-name {
    font-weight: 700;
    color: #2c3e50;
    font-size: 1.2em;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.property-icon {
    font-size: 1.3em;
    margin-right: 10px;
}

.owner-badge {
    font-size: 0.85em;
    margin: 8px 0;
    padding: 6px 12px;
    border-radius: 20px;
    display: inline-block;
    font-weight: 600;
}

.property-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin: 15px 0;
    font-size: 0.95em;
}

.property-info-item {
    padding: 8px;
    background: #f8f9fa;
    border-radius: 10px;
    text-align: center;
}

.property-info-value {
    font-weight: 700;
    color: #667eea;
    font-size: 1.1em;
    margin-top: 5px;
}

.rent-info {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 15px;
    border-radius: 12px;
    margin: 15px 0;
    border-left: 4px solid #667eea;
}

.rent-amount {
    font-size: 1.4em;
    font-weight: 800;
    color: #2c3e50;
    display: block;
    margin: 10px 0;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 2px dashed #e0e0e0;
}

.controls-column {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
    min-width: 200px;
}

.house-controls {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 15px;
    padding: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    flex-wrap: wrap;
}

.house-count {
    font-weight: 800;
    color: #2c3e50;
    font-size: 1.3em;
    display: flex;
    align-items: center;
    gap: 5px;
}

.house-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.player-item {
    margin: 12px 0;
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
}

.player-item:hover {
    transform: translateX(5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
}

.player-color {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    flex-shrink: 0;
}

.player-inputs {
    display: flex;
    flex: 1;
    gap: 10px;
    flex-wrap: wrap;
}

.player-inputs input {
    flex: 1;
    min-width: 120px;
}

.remove-player {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.3s ease;
}

.remove-player:hover {
    transform: scale(1.1);
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 999;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.monopoly-badge {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: #2c3e50;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 800;
    margin-left: 10px;
    animation: pulse 2s infinite;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.mortgage-badge {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 800;
    margin-left: 10px;
}

.tab-buttons {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
    justify-content: center;
}

.tab-button {
    flex: 1;
    min-width: 140px;
    padding: 15px;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.tab-button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

.tab-button.active {
    background: white;
    color: #667eea;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.mobile-menu {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 15px;
    z-index: 100;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
    border-radius: 25px 25px 0 0;
}

.mobile-menu-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

.mobile-menu button {
    padding: 12px;
    font-size: 0.85em;
    margin: 0;
}

.dice-roller {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    padding: 20px;
    border-radius: 15px;
    margin: 20px 0;
    color: white;
    text-align: center;
}

.dice-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
}

.dice {
    width: 60px;
    height: 60px;
    background: white;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    font-weight: 800;
    color: #2c3e50;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    animation: diceRoll 1s ease;
}

@keyframes diceRoll {
    0% { transform: rotate(0deg) scale(0.5); }
    50% { transform: rotate(180deg) scale(1.2); }
    100% { transform: rotate(360deg) scale(1); }
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.stat-value {
    font-size: 2em;
    font-weight: 800;
    color: #667eea;
    margin: 10px 0;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9em;
}

.save-notification {
    position: fixed;
    bottom: 100px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 1000;
    animation: slideInRight 0.3s ease;
    display: none;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.auto-save-indicator {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.8em;
    color: #666;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    display: none;
    align-items: center;
    gap: 8px;
}

@media (max-width: 768px) {
    .container {
        flex-direction: column;
        gap: 10px;
    }
    
    .box {
        width: 100%;
        max-width: 100%;
        padding: 15px;
        margin-bottom: 10px;
    }
    
    h1 {
        font-size: 1.4em;
        padding: 12px;
    }
    
    button {
        padding: 10px 15px;
        font-size: 0.9em;
    }
    
    .mobile-menu {
        display: block;
    }
    
    .desktop-only {
        display: none;
    }
    
    .property-info {
        grid-template-columns: 1fr;
    }
    
    .controls-column {
        min-width: 100%;
    }
    
    .tab-button {
        min-width: 120px;
        padding: 12px;
    }
    
    .card {
        padding: 20px;
        min-width: 95%;
        max-height: 90vh;
    }
    
    .save-notification {
        bottom: 80px;
        right: 10px;
        left: 10px;
        text-align: center;
    }
    
    .auto-save-indicator {
        top: 10px;
        right: 10px;
        left: 10px;
        justify-content: center;
    }
}

@media (min-width: 769px) {
    .mobile-menu {
        display: none;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üè¢ –ú–æ–Ω–æ–ø–æ–ª—ñ—è ‚Äî –û–±–ª—ñ–∫ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ üè†üöÇ‚ö°üíß</h1>
</div>

<div class="auto-save-indicator" id="autoSaveIndicator">
    <span class="save-icon">üíæ</span>
    <span class="save-text">–ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è...</span>
</div>

<div class="tab-buttons">
    <button class="tab-button active" onclick="switchTab('streets')">
        <span class="box-header-icon">üèòÔ∏è</span> –í—É–ª–∏—Ü—ñ
    </button>
    <button class="tab-button" onclick="switchTab('railroads')">
        <span class="box-header-icon">üöÇ</span> –í–æ–∫–∑–∞–ª–∏
    </button>
    <button class="tab-button" onclick="switchTab('utilities')">
        <span class="box-header-icon">‚ö°</span> –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
    </button>
    <button class="tab-button" onclick="switchTab('players')">
        <span class="box-header-icon">üë•</span> –ì—Ä–∞–≤—Ü—ñ
    </button>
    <button class="tab-button" onclick="switchTab('actions')">
        <span class="box-header-icon">üé¥</span> –î—ñ—ó
    </button>
</div>

<div class="container">
    <div class="box" id="players-box">
        <div class="box-header players">
            <span class="box-header-icon">üë•</span>
            <h2>–ì—Ä–∞–≤—Ü—ñ</h2>
        </div>
        <div id="players"></div>
        <button onclick="addPlayer()">
            <span>‚ûï</span> –î–æ–¥–∞—Ç–∏ –≥—Ä–∞–≤—Ü—è
        </button>
        <div class="total-value" id="playerStats"></div>
    </div>

    <div class="box" id="streets-box">
        <div class="box-header streets">
            <span class="box-header-icon">üèòÔ∏è</span>
            <h2>–í—É–ª–∏—Ü—ñ</h2>
        </div>
        <div id="streets"></div>
        <div class="total-value" id="streetStats"></div>
    </div>

    <div class="box" id="railroads-box">
        <div class="box-header railroads">
            <span class="box-header-icon">üöÇ</span>
            <h2>–í–æ–∫–∑–∞–ª–∏</h2>
        </div>
        <div id="railroads"></div>
        <div class="total-value" id="railroadStats"></div>
    </div>

    <div class="box" id="utilities-box">
        <div class="box-header utilities">
            <span class="box-header-icon">‚ö°</span>
            <h2>–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó</h2>
        </div>
        <div id="utilities"></div>
        <div class="total-value" id="utilityStats"></div>
    </div>

    <div class="box" id="actions-box">
        <div class="box-header cards">
            <span class="box-header-icon">üé¥</span>
            <h2>–î—ñ—ó —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</h2>
        </div>
        
        <div class="card-buttons">
            <button onclick="openChance()" class="warning">
                <span>üé≤</span> –®–∞–Ω—Å
            </button>
            <button onclick="openCommunity()" class="success">
                <span>üì¶</span> –ö–∞–∑–Ω–∞
            </button>
            <button onclick="showAllProperties()">
                <span>üìã</span> –í—Å—è –≤–ª–∞—Å–Ω—ñ—Å—Ç—å
            </button>
            <button onclick="drawTransportCard()" class="secondary">
                <span>üöó</span> –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            </button>
            <button onclick="saveGameManually()" class="success">
                <span>üíæ</span> –ó–±–µ—Ä–µ–≥—Ç–∏ –≥—Ä—É
            </button>
            <button onclick="loadGame()" class="warning">
                <span>üìÇ</span> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
            </button>
            <button onclick="resetGame()" class="danger">
                <span>üîÑ</span> –ù–æ–≤–∞ –≥—Ä–∞
            </button>
        </div>
        
        <h3>üé≤ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ä–µ–Ω–¥–∏</h3>
        <div id="rentCalculator">
            <select id="calcSelectType" onchange="updateRentCalculator()">
                <option value="street">–í—É–ª–∏—Ü—è</option>
                <option value="railroad">–í–æ–∫–∑–∞–ª</option>
                <option value="utility">–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è</option>
            </select>
            <select id="calcSelect" onchange="calculateRentForSelected()">
                <option value="">–û–±–µ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—ñ—Å—Ç—å</option>
            </select>
            <div id="rentResult" class="rent-info" style="margin-top: 15px;"></div>
        </div>
        
        <div class="dice-roller">
            <h3>üé≤ –ö–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫–∏</h3>
            <div class="dice-container">
                <div class="dice" id="dice1">?</div>
                <div class="dice" id="dice2">?</div>
            </div>
            <button onclick="rollDice()" class="small" style="width: auto;">
                üé≤ –ö–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫–∏
            </button>
            <div id="diceResult" style="margin-top: 15px; font-weight: bold;"></div>
        </div>
        
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∏</h3>
        <div id="gameStats"></div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 15px; font-size: 0.9em; color: #666;">
            <strong>üíæ –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:</strong> –ü—Ä–æ–≥—Ä–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
        </div>
    </div>
</div>

<div class="mobile-menu">
    <div class="mobile-menu-grid">
        <button onclick="openChance()" class="small warning">
            üé≤ –®–∞–Ω—Å
        </button>
        <button onclick="openCommunity()" class="small success">
            üì¶ –ö–∞–∑–Ω–∞
        </button>
        <button onclick="drawTransportCard()" class="small secondary">
            üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        </button>
        <button onclick="saveGameManually()" class="small success">
            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
        </button>
        <button onclick="rollDice()" class="small">
            üé≤ –ö—É–±–∏–∫–∏
        </button>
        <button onclick="resetGame()" class="small danger">
            üîÑ –ù–æ–≤–∞
        </button>
    </div>
</div>

<div id="saveNotification" class="save-notification">
    üíæ –ì—Ä–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞!
</div>

<div id="overlay" class="overlay hidden" onclick="closeCard()"></div>

<div id="card" class="card hidden">
    <h2 id="cardTitle"></h2>
    <div id="cardContent"></div>
    <button onclick="closeCard()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<script>
// –ö–ª—é—á—ñ –¥–ª—è localStorage
const STORAGE_KEYS = {
    PLAYERS: 'monopoly_players',
    PROPERTIES: 'monopoly_properties',
    RAILROADS: 'monopoly_railroads',
    UTILITIES: 'monopoly_utilities',
    TRANSPORT_CARDS: 'monopoly_transport_cards',
    LAST_SAVED: 'monopoly_last_saved',
    GAME_VERSION: 'monopoly_game_version'
};

// –í–µ—Ä—Å—ñ—è –≥—Ä–∏ (–¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω—å)
const GAME_VERSION = '1.2';

// –î–∞–Ω—ñ –≥—Ä–∏
let players = [];
let transportCardsUsed = [];

// –®–∞–±–ª–æ–Ω–∏ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ (–¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó)
const propertyTemplates = [
    // üî¥ –ö–æ—Ä–∏—á–Ω–µ–≤–∞ –≥—Ä—É–ø–∞ (2 –≤—É–ª–∏—Ü—ñ)
    {name: "–ß–∫–∞–ª–æ–≤–∞", price: 60, rent: [2, 10, 30, 90, 160, 250], houseCost: 50, color: "#8B4513", group: "brown", houses: 0},
    {name: "–¢–µ–ª—å–º–∞–Ω–∞", price: 60, rent: [4, 20, 60, 180, 320, 450], houseCost: 50, color: "#8B4513", group: "brown", houses: 0},

    // üîµ –ë–ª–∞–∫–∏—Ç–Ω–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–í–æ–∫–∑–∞–ª—å–Ω–∞", price: 100, rent: [6, 30, 90, 270, 400, 550], houseCost: 50, color: "#87CEEB", group: "lightblue", houses: 0},
    {name: "–û–∑–µ—Ä–Ω–∞", price: 100, rent: [6, 30, 90, 270, 400, 550], houseCost: 50, color: "#87CEEB", group: "lightblue", houses: 0},
    {name: "–ü–æ–ª—å–æ–≤–∞", price: 120, rent: [8, 40, 100, 300, 450, 600], houseCost: 50, color: "#87CEEB", group: "lightblue", houses: 0},

    // üü£ –†–æ–∂–µ–≤–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–ú–∞—Ç—Ä–æ—Å–æ–≤–∞", price: 140, rent: [10, 50, 150, 450, 625, 750], houseCost: 100, color: "#FF69B4", group: "pink", houses: 0},
    {name: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞", price: 140, rent: [10, 50, 150, 450, 625, 750], houseCost: 100, color: "#FF69B4", group: "pink", houses: 0},
    {name: "–ú–∞—è–∫–æ–≤—Å—å–∫–æ–≥–æ", price: 160, rent: [12, 60, 180, 500, 700, 900], houseCost: 100, color: "#FF69B4", group: "pink", houses: 0},

    // üü† –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–í–∞—Ç—É—Ç—ñ–Ω–∞", price: 180, rent: [14, 70, 200, 550, 750, 950], houseCost: 100, color: "#FFA500", group: "orange", houses: 0},
    {name: "–°–∞–¥–æ–≤–∞", price: 180, rent: [14, 70, 200, 550, 750, 950], houseCost: 100, color: "#FFA500", group: "orange", houses: 0},
    {name: "–°–æ–Ω—è—á–Ω–∞", price: 200, rent: [16, 80, 220, 600, 800, 1000], houseCost: 100, color: "#FFA500", group: "orange", houses: 0},

    // üî¥ –ß–µ—Ä–≤–æ–Ω–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–ú–æ–ª–æ–¥—ñ–∂–Ω–∞", price: 220, rent: [18, 90, 250, 700, 875, 1050], houseCost: 150, color: "#FF0000", group: "red", houses: 0},
    {name: "–§—Ä—É–Ω–∑–µ", price: 220, rent: [18, 90, 250, 700, 875, 1050], houseCost: 150, color: "#FF0000", group: "red", houses: 0},
    {name: "–ó–∞–≤–æ–¥—Å—å–∫–∞", price: 240, rent: [20, 100, 300, 750, 925, 1100], houseCost: 150, color: "#FF0000", group: "red", houses: 0},

    // üü° –ñ–æ–≤—Ç–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–ö–æ–∑–∞—Ü—å–∫–∞", price: 260, rent: [22, 110, 330, 800, 975, 1150], houseCost: 150, color: "#FFD700", group: "yellow", houses: 0},
    {name: "–õ–µ—Å—ñ –£–∫—Ä–∞—ó–Ω–∫–∏", price: 260, rent: [22, 110, 330, 800, 975, 1150], houseCost: 150, color: "#FFD700", group: "yellow", houses: 0},
    {name: "–°–æ–±–æ—Ä–Ω–∞", price: 280, rent: [24, 120, 360, 850, 1025, 1200], houseCost: 150, color: "#FFD700", group: "yellow", houses: 0},

    // üü¢ –ó–µ–ª–µ–Ω–∞ –≥—Ä—É–ø–∞ (3 –≤—É–ª–∏—Ü—ñ)
    {name: "–ì—Ä—É—à–µ–≤—Å—å–∫–æ–≥–æ", price: 300, rent: [26, 130, 390, 900, 1100, 1275], houseCost: 200, color: "#32CD32", group: "green", houses: 0},
    {name: "–ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ", price: 300, rent: [26, 130, 390, 900, 1100, 1275], houseCost: 200, color: "#32CD32", group: "green", houses: 0},
    {name: "–®–µ–≤—á–µ–Ω–∫–∞", price: 320, rent: [28, 150, 450, 1000, 1200, 1400], houseCost: 200, color: "#32CD32", group: "green", houses: 0},

    // üîµ –°–∏–Ω—è –≥—Ä—É–ø–∞ (2 –≤—É–ª–∏—Ü—ñ)
    {name: "–ö–∏—ó–≤—Å—å–∫–∞", price: 350, rent: [35, 175, 500, 1100, 1300, 1500], houseCost: 200, color: "#0000FF", group: "blue", houses: 0},
    {name: "–ú–∏—Ä—É", price: 400, rent: [50, 200, 600, 1400, 1700, 2000], houseCost: 200, color: "#0000FF", group: "blue", houses: 0}
];

const railroadTemplates = [
    {name: "–ó–∞–ª—ñ–∑–Ω–∏—á–Ω–∞ –∞–≤—Ç–æ—Å—Ç–∞–Ω—Ü—ñ—è", price: 200, color: "#795548", mortgage: 100, group: "railroad", icon: "üöÇ"},
    {name: "–ë—É—Ä—è–∫–æ–ø—É–Ω–∫—Ç", price: 200, color: "#795548", mortgage: 100, group: "railroad", icon: "üöö"},
    {name: "–ì–∞–¥—è—Ü—å–∫–∞ —Ç—Ä–∞—Å–∞", price: 200, color: "#795548", mortgage: 100, group: "railroad", icon: "üõ£Ô∏è"},
    {name: "–í–æ–∫–∑–∞–ª", price: 200, color: "#795548", mortgage: 100, group: "railroad", icon: "üöâ"}
];

const utilityTemplates = [
    {name: "–ê—Ä—Ç–æ–ø–æ–ª—ñ—Ç (–í–æ–¥–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è)", price: 150, color: "#2196F3", mortgage: 75, group: "utility", icon: "üíß"},
    {name: "–û–±–ª–µ–Ω–µ—Ä–≥–æ (–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è)", price: 150, color: "#FF9800", mortgage: 75, group: "utility", icon: "‚ö°"}
];

const transportCardTemplates = [
    {type: "control", name: "–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ—ó–∑–¥", description: "–ú–æ–∂–µ—à –ø–æ—ó—Ö–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫—É –∫–ª—ñ—Ç–∏–Ω–∫—É –ø–æ–ª—è. ‚ùó –Ø–∫—â–æ –ø—Ä–æ—ó–∂–¥–∂–∞—î—à ¬´–°—Ç–∞—Ä—Ç¬ª ‚Äî +200 –ù–ï –æ—Ç—Ä–∏–º—É—î—à"},
    {type: "control", name: "–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ—ó–∑–¥", description: "–ú–æ–∂–µ—à –ø–æ—ó—Ö–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫—É –∫–ª—ñ—Ç–∏–Ω–∫—É –ø–æ–ª—è. ‚ùó –Ø–∫—â–æ –ø—Ä–æ—ó–∂–¥–∂–∞—î—à ¬´–°—Ç–∞—Ä—Ç¬ª ‚Äî +200 –ù–ï –æ—Ç—Ä–∏–º—É—î—à"},
    {type: "control", name: "–ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ—ó–∑–¥", description: "–ú–æ–∂–µ—à –ø–æ—ó—Ö–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫—É –∫–ª—ñ—Ç–∏–Ω–∫—É –ø–æ–ª—è. ‚ùó –Ø–∫—â–æ –ø—Ä–æ—ó–∂–¥–∂–∞—î—à ¬´–°—Ç–∞—Ä—Ç¬ª ‚Äî +200 –ù–ï –æ—Ç—Ä–∏–º—É—î—à"},
    {type: "free", name: "–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –ø–æ—ó–∑–¥–∫–∞", description: "–í–∏ –º–æ–∂–µ—Ç–µ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –ø—Ä–æ—ó—Ö–∞—Ç–∏ –¥–æ –±—É–¥—å-—è–∫–æ—ó —Ç–æ—á–∫–∏ –ø–æ–ª—è. –¶—è –∫–∞—Ä—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è."},
    {type: "free", name: "–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –ø–æ—ó–∑–¥–∫–∞", description: "–í–∏ –º–æ–∂–µ—Ç–µ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –ø—Ä–æ—ó—Ö–∞—Ç–∏ –¥–æ –±—É–¥—å-—è–∫–æ—ó —Ç–æ—á–∫–∏ –ø–æ–ª—è. –¶—è –∫–∞—Ä—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è."},
    {type: "pay", name: "–ó–∞–ø–ª–∞—Ç–∏ —â–µ", description: "–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–ø–ª–∞—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ 50 ‚Ç¥ –∑–∞ –ø–æ—ó–∑–¥–∫—É. –Ø–∫—â–æ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø–ª–∞—Ç–∏—Ç–∏, –ø–æ–≤–∏–Ω–Ω—ñ –ø—Ä–æ–¥–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω—É –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ."},
    {type: "jail", name: "–á–¥–µ—à —É –≤ º—è–∑–Ω–∏—Ü—é", description: "–í–∏ –ø—Ä—è–º—É—î—Ç–µ –ø—Ä—è–º–æ –¥–æ –≤ º—è–∑–Ω–∏—Ü—ñ. –ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –°—Ç–∞—Ä—Ç, –Ω–µ –æ—Ç—Ä–∏–º—É—î—Ç–µ 200 ‚Ç¥."},
    {type: "pay", name: "–ó–∞–ø–ª–∞—Ç–∏ —â–µ", description: "–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–ø–ª–∞—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ 100 ‚Ç¥ –∑–∞ –ø–æ—ó–∑–¥–∫—É. –Ø–∫—â–æ –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø–ª–∞—Ç–∏—Ç–∏, –ø–æ–≤–∏–Ω–Ω—ñ –ø—Ä–æ–¥–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω—É –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ."}
];

// –ü–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –≥—Ä–∏
let properties = [];
let railroads = [];
let utilities = [];
let transportCards = [];

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
function init() {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≥—Ä–∞
    if (hasSavedGame()) {
        showLoadGamePrompt();
    } else {
        startNewGame();
    }
}

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó –≥—Ä–∏
function hasSavedGame() {
    const savedPlayers = localStorage.getItem(STORAGE_KEYS.PLAYERS);
    const savedProperties = localStorage.getItem(STORAGE_KEYS.PROPERTIES);
    const savedVersion = localStorage.getItem(STORAGE_KEYS.GAME_VERSION);
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤–µ—Ä—Å—ñ—é –≥—Ä–∏
    if (savedVersion !== GAME_VERSION) {
        console.log('–í–µ—Ä—Å—ñ—è –≥—Ä–∏ –æ–Ω–æ–≤–∏–ª–∞—Å—å, –æ—á–∏—â–∞—î–º–æ —Å—Ç–∞—Ä–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
        clearSavedGame();
        return false;
    }
    
    return savedPlayers && savedProperties;
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∏
function showLoadGamePrompt() {
    const lastSaved = localStorage.getItem(STORAGE_KEYS.LAST_SAVED);
    const lastSavedText = lastSaved ? `(–æ—Å—Ç–∞–Ω–Ω—î –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${new Date(parseInt(lastSaved)).toLocaleString()})` : '';
    
    const content = `
        <div style="text-align: left; padding: 20px;">
            <h3>üíæ –ó–Ω–∞–π–¥–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –≥—Ä—É!</h3>
            <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                ${lastSavedText}
            </div>
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="loadGame(); closeCard();" style="flex: 1; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≥—Ä—É
                </button>
                <button onclick="startNewGame(); closeCard();" style="flex: 1; padding: 15px; background: #ff9800; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    üÜï –ü–æ—á–∞—Ç–∏ –Ω–æ–≤—É
                </button>
            </div>
        </div>
    `;
    
    showCard('–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—É –≥—Ä—É?', content);
}

// –ü–æ—á–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É
function startNewGame() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –≥—Ä—É
    players = [
        {name: "–ì—Ä–∞–≤–µ—Ü—å 1", color: "#FF6B6B", money: 1500},
        {name: "–ì—Ä–∞–≤–µ—Ü—å 2", color: "#4ECDC4", money: 1500}
    ];
    
    transportCardsUsed = [];
    
    // –ö–æ–ø—ñ—é—î–º–æ —à–∞–±–ª–æ–Ω–∏
    properties = JSON.parse(JSON.stringify(propertyTemplates));
    railroads = JSON.parse(JSON.stringify(railroadTemplates));
    utilities = JSON.parse(JSON.stringify(utilityTemplates));
    transportCards = JSON.parse(JSON.stringify(transportCardTemplates));
    
    // –°–∫–∏–¥–∞—î–º–æ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å
    properties.forEach(prop => {
        prop.owner = null;
        prop.houses = 0;
    });
    
    railroads.forEach(rr => {
        rr.owner = null;
        rr.mortgaged = false;
    });
    
    utilities.forEach(util => {
        util.owner = null;
        util.mortgaged = false;
    });
    
    renderPlayers();
    updateGame();
    populateRentCalculator();
    switchTab('streets');
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–æ–≤—É –≥—Ä—É
    saveGame();
    showSaveNotification('–ù–æ–≤–∞ –≥—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞!');
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≥—Ä—É
function loadGame() {
    try {
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≥—Ä–∞–≤—Ü—ñ–≤
        const savedPlayers = localStorage.getItem(STORAGE_KEYS.PLAYERS);
        if (savedPlayers) {
            players = JSON.parse(savedPlayers);
        }
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—É–ª–∏—Ü—ñ
        const savedProperties = localStorage.getItem(STORAGE_KEYS.PROPERTIES);
        if (savedProperties) {
            properties = JSON.parse(savedProperties);
        }
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤–æ–∫–∑–∞–ª–∏
        const savedRailroads = localStorage.getItem(STORAGE_KEYS.RAILROADS);
        if (savedRailroads) {
            railroads = JSON.parse(savedRailroads);
        }
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
        const savedUtilities = localStorage.getItem(STORAGE_KEYS.UTILITIES);
        if (savedUtilities) {
            utilities = JSON.parse(savedUtilities);
        }
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ñ –∫–∞—Ä—Ç–∏
        const savedTransportCards = localStorage.getItem(STORAGE_KEYS.TRANSPORT_CARDS);
        if (savedTransportCards) {
            transportCardsUsed = JSON.parse(savedTransportCards);
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —à–∞–±–ª–æ–Ω–∏ –∫–∞—Ä—Ç
        transportCards = JSON.parse(JSON.stringify(transportCardTemplates));
        
        renderPlayers();
        updateGame();
        populateRentCalculator();
        switchTab('streets');
        
        showSaveNotification('–ì—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞!');
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        const lastSaved = localStorage.getItem(STORAGE_KEYS.LAST_SAVED);
        if (lastSaved) {
            updateAutoSaveIndicator(new Date(parseInt(lastSaved)));
        }
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∏:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∏. –ü–æ—á–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É?');
        startNewGame();
    }
}

// –ó–±–µ—Ä–µ–≥—Ç–∏ –≥—Ä—É
function saveGame() {
    try {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –¥–∞–Ω—ñ
        localStorage.setItem(STORAGE_KEYS.PLAYERS, JSON.stringify(players));
        localStorage.setItem(STORAGE_KEYS.PROPERTIES, JSON.stringify(properties));
        localStorage.setItem(STORAGE_KEYS.RAILROADS, JSON.stringify(railroads));
        localStorage.setItem(STORAGE_KEYS.UTILITIES, JSON.stringify(utilities));
        localStorage.setItem(STORAGE_KEYS.TRANSPORT_CARDS, JSON.stringify(transportCardsUsed));
        localStorage.setItem(STORAGE_KEYS.LAST_SAVED, Date.now().toString());
        localStorage.setItem(STORAGE_KEYS.GAME_VERSION, GAME_VERSION);
        
        // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        showAutoSaveIndicator();
        
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä–∏:', error);
    }
}

// –†—É—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä–∏
function saveGameManually() {
    saveGame();
    showSaveNotification('–ì—Ä–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –≤—Ä—É—á–Ω—É!');
}

// –û—á–∏—Å—Ç–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—É –≥—Ä—É
function clearSavedGame() {
    Object.values(STORAGE_KEYS).forEach(key => {
        localStorage.removeItem(key);
    });
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
function showAutoSaveIndicator() {
    const indicator = document.getElementById('autoSaveIndicator');
    const saveText = indicator.querySelector('.save-text');
    
    saveText.textContent = '–ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';
    indicator.style.display = 'flex';
    
    // –ê–Ω—ñ–º–∞—Ü—ñ—è
    setTimeout(() => {
        saveText.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–æ!';
        setTimeout(() => {
            indicator.style.display = 'none';
        }, 1000);
    }, 500);
}

// –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
function updateAutoSaveIndicator(lastSaveDate) {
    const now = new Date();
    const diffMs = now - lastSaveDate;
    const diffMins = Math.floor(diffMs / 60000);
    
    let text;
    if (diffMins < 1) {
        text = '–ó–±–µ—Ä–µ–∂–µ–Ω–æ —â–æ–π–Ω–æ';
    } else if (diffMins < 60) {
        text = `–ó–±–µ—Ä–µ–∂–µ–Ω–æ ${diffMins} —Ö–≤ —Ç–æ–º—É`;
    } else if (diffMins < 1440) {
        const hours = Math.floor(diffMins / 60);
        text = `–ó–±–µ—Ä–µ–∂–µ–Ω–æ ${hours} –≥–æ–¥ —Ç–æ–º—É`;
    } else {
        const days = Math.floor(diffMins / 1440);
        text = `–ó–±–µ—Ä–µ–∂–µ–Ω–æ ${days} –¥–Ω —Ç–æ–º—É`;
    }
    
    const indicator = document.getElementById('autoSaveIndicator');
    const saveText = indicator.querySelector('.save-text');
    
    saveText.textContent = text;
    indicator.style.display = 'flex';
    
    // –•–æ–≤–∞—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        indicator.style.display = 'none';
    }, 5000);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
function showSaveNotification(message) {
    const notification = document.getElementById('saveNotification');
    notification.textContent = message || 'üíæ –ì—Ä–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∞!';
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫
function switchTab(tabName) {
    // –û–Ω–æ–≤–ª—é—î–º–æ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const tabs = ['streets', 'railroads', 'utilities', 'players', 'actions'];
    const tabIndex = tabs.indexOf(tabName);
    if (tabIndex >= 0) {
        document.querySelectorAll('.tab-button')[tabIndex].classList.add('active');
    }
    
    // –ü–æ–∫–∞–∑—É—î–º–æ/—Ö–æ–≤–∞—î–º–æ –±–æ–∫—Å–∏
    const allBoxes = ['streets-box', 'railroads-box', 'utilities-box', 'players-box', 'actions-box'];
    allBoxes.forEach(box => {
        document.getElementById(box).style.display = 'none';
    });
    
    // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –±–æ–∫—Å–∏
    if (tabName === 'streets') {
        document.getElementById('streets-box').style.display = 'block';
        document.getElementById('actions-box').style.display = 'block';
    } else if (tabName === 'railroads') {
        document.getElementById('railroads-box').style.display = 'block';
        document.getElementById('actions-box').style.display = 'block';
    } else if (tabName === 'utilities') {
        document.getElementById('utilities-box').style.display = 'block';
        document.getElementById('actions-box').style.display = 'block';
    } else if (tabName === 'players') {
        document.getElementById('players-box').style.display = 'block';
        document.getElementById('actions-box').style.display = 'block';
    } else if (tabName === 'actions') {
        document.getElementById('actions-box').style.display = 'block';
    }
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—ñ–≤
function renderPlayers() {
    const div = document.getElementById("players");
    div.innerHTML = "";
    
    players.forEach((player, index) => {
        div.innerHTML += `
            <div class="player-item">
                <div class="player-color" style="background-color: ${player.color}"></div>
                <div class="player-inputs">
                    <input value="${player.name}" onchange="players[${index}].name=this.value; updateGameAndSave()" placeholder="–Ü–º'—è –≥—Ä–∞–≤—Ü—è">
                    <input type="number" value="${player.money}" onchange="players[${index}].money=parseInt(this.value); updateGameAndSave()" placeholder="–ì—Ä–æ—à—ñ">
                </div>
                <button class="remove-player" onclick="removePlayer(${index})">√ó</button>
            </div>`;
    });
}

// –î–æ–¥–∞–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—è
function addPlayer() {
    if (players.length >= 8) return alert("–ú–∞–∫—Å–∏–º—É–º 8 –≥—Ä–∞–≤—Ü—ñ–≤");
    
    const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2', '#EF476F', '#7209B7', '#F15BB5'];
    const playerNum = players.length + 1;
    
    players.push({
        name: `–ì—Ä–∞–≤–µ—Ü—å ${playerNum}`,
        color: colors[players.length % colors.length],
        money: 1500
    });
    
    renderPlayers();
    updateGameAndSave();
    populateRentCalculator();
}

// –í–∏–¥–∞–ª–µ–Ω–Ω—è –≥—Ä–∞–≤—Ü—è
function removePlayer(index) {
    if (confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä–∞–≤—Ü—è ${players[index].name}? –£—Å—ñ –π–æ–≥–æ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ –±—É–¥—É—Ç—å –∑–≤—ñ–ª—å–Ω–µ–Ω—ñ.`)) {
        // –ó–≤—ñ–ª—å–Ω—è—î–º–æ –≤—É–ª–∏—Ü—ñ
        properties.forEach(property => {
            if (property.owner === players[index].name) {
                property.owner = null;
                property.houses = 0;
            }
        });
        
        // –ó–≤—ñ–ª—å–Ω—è—î–º–æ –≤–æ–∫–∑–∞–ª–∏
        railroads.forEach(railroad => {
            if (railroad.owner === players[index].name) {
                railroad.owner = null;
                railroad.mortgaged = false;
            }
        });
        
        // –ó–≤—ñ–ª—å–Ω—è—î–º–æ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
        utilities.forEach(utility => {
            if (utility.owner === players[index].name) {
                utility.owner = null;
                utility.mortgaged = false;
            }
        });
        
        players.splice(index, 1);
        renderPlayers();
        updateGameAndSave();
        populateRentCalculator();
    }
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—É–ª–∏—Ü—å
function renderStreets() {
    const div = document.getElementById("streets");
    div.innerHTML = "";
    
    properties.forEach((property, index) => {
        const isOwned = property.owner ? true : false;
        const ownerColor = isOwned ? getPlayerColor(property.owner) : '#cccccc';
        const isMonopoly = checkMonopoly(property.group, property.owner);
        const currentRent = calculateCurrentRent(property);
        
        div.innerHTML += `
            <div class="property-item" style="--property-color: ${property.color}; border-left-color: ${property.color}">
                <div class="property-name">
                    <span>
                        <span class="property-icon">üèòÔ∏è</span>
                        ${property.name}
                        ${isMonopoly ? '<span class="monopoly-badge">‚≠ê –ú–æ–Ω–æ–ø–æ–ª—ñ—è</span>' : ''}
                    </span>
                </div>
                
                <div class="owner-badge" style="background-color: ${ownerColor}20; color: ${ownerColor}; border: 1px solid ${ownerColor}">
                    ${property.owner ? "üëë " + property.owner : "üÜì –í—ñ–ª—å–Ω–∞"}
                </div>
                
                <div class="property-info">
                    <div class="property-info-item">
                        <div>–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                        <div class="property-info-value">${property.price} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–ë—É–¥–∏–Ω–æ–∫</div>
                        <div class="property-info-value">${property.houseCost} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–ë—É–¥–∏–Ω–∫–∏</div>
                        <div class="property-info-value">${property.houses === 5 ? 'üè® –ì–æ—Ç–µ–ª—å' : property.houses}</div>
                    </div>
                </div>
                
                <div class="rent-info">
                    <div>–ü–æ—Ç–æ—á–Ω–∞ –æ—Ä–µ–Ω–¥–∞:</div>
                    <div class="rent-amount">${currentRent} ‚Ç¥</div>
                </div>
                
                ${isOwned && isMonopoly ? `
                    <div class="house-controls">
                        <div class="house-count">
                            <span>üè†</span> –ë—É–¥–∏–Ω–∫–∏: ${property.houses === 5 ? 'üè®' : property.houses}
                        </div>
                        <div class="house-buttons">
                            <button onclick="addHouse(${index})" class="small success" ${property.houses >= 5 ? 'disabled' : ''}>
                                ‚ûï –î–æ–¥–∞—Ç–∏
                            </button>
                            <button onclick="removeHouse(${index})" class="small warning" ${property.houses <= 0 ? 'disabled' : ''}>
                                ‚ûñ –ó–Ω—è—Ç–∏
                            </button>
                            <button onclick="addHotel(${index})" class="small" ${property.houses !== 4 ? 'disabled' : ''}>
                                üè® –ì–æ—Ç–µ–ª—å
                            </button>
                        </div>
                    </div>
                ` : ''}
                
                <div class="controls">
                    <div class="controls-column">
                        <select onchange="assignProperty(${index}, this.value, 'street')" ${players.length === 0 ? 'disabled' : ''}>
                            <option value="">‚Äî –æ–±—Ä–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞ ‚Äî</option>
                            ${players.map(player => `<option ${property.owner === player.name ? 'selected' : ''}>${player.name}</option>`).join("")}
                        </select>
                    </div>
                    <div class="controls-column">
                        <button onclick="showPropertyCard(${index})" class="small">
                            üìã –ö–∞—Ä—Ç–∫–∞
                        </button>
                        ${property.owner ? `
                            <button onclick="freeProperty(${index}, 'street')" class="small danger">
                                üóëÔ∏è –ó–≤—ñ–ª—å–Ω–∏—Ç–∏
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>`;
    });
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–æ–∫–∑–∞–ª—ñ–≤
function renderRailroads() {
    const div = document.getElementById("railroads");
    div.innerHTML = "";
    
    railroads.forEach((railroad, index) => {
        const isOwned = railroad.owner ? true : false;
        const ownerColor = isOwned ? getPlayerColor(railroad.owner) : '#cccccc';
        const rent = calculateRailroadRent(railroad.owner);
        
        div.innerHTML += `
            <div class="property-item" style="--property-color: ${railroad.color}; border-left-color: ${railroad.color}">
                <div class="property-name">
                    <span>
                        <span class="property-icon">${railroad.icon}</span>
                        ${railroad.name}
                    </span>
                    ${railroad.mortgaged ? '<span class="mortgage-badge">üìâ –ó–∞–∫–ª–∞–¥–µ–Ω–æ</span>' : ''}
                </div>
                
                <div class="owner-badge" style="background-color: ${ownerColor}20; color: ${ownerColor}; border: 1px solid ${ownerColor}">
                    ${railroad.owner ? "üëë " + railroad.owner : "üÜì –í—ñ–ª—å–Ω–∏–π"}
                </div>
                
                <div class="property-info">
                    <div class="property-info-item">
                        <div>–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                        <div class="property-info-value">${railroad.price} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–ó–∞–ª–æ–≥</div>
                        <div class="property-info-value">${railroad.mortgage} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–í–∏–∫—É–ø</div>
                        <div class="property-info-value">${Math.round(railroad.mortgage * 1.1)} ‚Ç¥</div>
                    </div>
                </div>
                
                <div class="rent-info">
                    <div>–ü–æ—Ç–æ—á–Ω–∞ –æ—Ä–µ–Ω–¥–∞:</div>
                    <div class="rent-amount">${rent} ‚Ç¥</div>
                    <small>${railroad.owner ? `–í–ª–∞—Å–Ω–∏–∫ –º–∞—î ${countRailroadsByOwner(railroad.owner)} –≤–æ–∫–∑–∞–ª—ñ–≤` : ''}</small>
                </div>
                
                <div class="controls">
                    <div class="controls-column">
                        <select onchange="assignProperty(${index}, this.value, 'railroad')" ${players.length === 0 ? 'disabled' : ''}>
                            <option value="">‚Äî –æ–±—Ä–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞ ‚Äî</option>
                            ${players.map(player => `<option ${railroad.owner === player.name ? 'selected' : ''}>${player.name}</option>`).join("")}
                        </select>
                    </div>
                    <div class="controls-column">
                        <button onclick="showRailroadCard(${index})" class="small">
                            üìã –ö–∞—Ä—Ç–∫–∞
                        </button>
                        ${railroad.owner ? `
                            <button onclick="toggleMortgage(${index}, 'railroad')" class="small warning">
                                ${railroad.mortgaged ? 'üìà –í–∏–∫—É–ø–∏—Ç–∏' : 'üìâ –ó–∞–∫–ª–∞—Å—Ç–∏'}
                            </button>
                            <button onclick="freeProperty(${index}, 'railroad')" class="small danger">
                                üóëÔ∏è –ó–≤—ñ–ª—å–Ω–∏—Ç–∏
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>`;
    });
}

// –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π
function renderUtilities() {
    const div = document.getElementById("utilities");
    div.innerHTML = "";
    
    utilities.forEach((utility, index) => {
        const isOwned = utility.owner ? true : false;
        const ownerColor = isOwned ? getPlayerColor(utility.owner) : '#cccccc';
        
        div.innerHTML += `
            <div class="property-item" style="--property-color: ${utility.color}; border-left-color: ${utility.color}">
                <div class="property-name">
                    <span>
                        <span class="property-icon">${utility.icon}</span>
                        ${utility.name}
                    </span>
                    ${utility.mortgaged ? '<span class="mortgage-badge">üìâ –ó–∞–∫–ª–∞–¥–µ–Ω–æ</span>' : ''}
                </div>
                
                <div class="owner-badge" style="background-color: ${ownerColor}20; color: ${ownerColor}; border: 1px solid ${ownerColor}">
                    ${utility.owner ? "üëë " + utility.owner : "üÜì –í—ñ–ª—å–Ω–∞"}
                </div>
                
                <div class="property-info">
                    <div class="property-info-item">
                        <div>–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                        <div class="property-info-value">${utility.price} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–ó–∞–ª–æ–≥</div>
                        <div class="property-info-value">${utility.mortgage} ‚Ç¥</div>
                    </div>
                    <div class="property-info-item">
                        <div>–í–∏–∫—É–ø</div>
                        <div class="property-info-value">${Math.round(utility.mortgage * 1.1)} ‚Ç¥</div>
                    </div>
                </div>
                
                <div class="rent-info">
                    <div>–û—Ä–µ–Ω–¥–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π:</div>
                    <div class="rent-amount">1 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è: (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó 4</div>
                    <div class="rent-amount">2 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó: (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó 10</div>
                </div>
                
                <div class="controls">
                    <div class="controls-column">
                        <select onchange="assignProperty(${index}, this.value, 'utility')" ${players.length === 0 ? 'disabled' : ''}>
                            <option value="">‚Äî –æ–±—Ä–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞ ‚Äî</option>
                            ${players.map(player => `<option ${utility.owner === player.name ? 'selected' : ''}>${player.name}</option>`).join("")}
                        </select>
                    </div>
                    <div class="controls-column">
                        <button onclick="showUtilityCard(${index})" class="small">
                            üìã –ö–∞—Ä—Ç–∫–∞
                        </button>
                        ${utility.owner ? `
                            <button onclick="toggleMortgage(${index}, 'utility')" class="small warning">
                                ${utility.mortgaged ? 'üìà –í–∏–∫—É–ø–∏—Ç–∏' : 'üìâ –ó–∞–∫–ª–∞—Å—Ç–∏'}
                            </button>
                            <button onclick="freeProperty(${index}, 'utility')" class="small danger">
                                üóëÔ∏è –ó–≤—ñ–ª—å–Ω–∏—Ç–∏
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>`;
    });
}

// –ü—Ä–∏–≤–ª–∞—Å–Ω–∏—Ç–∏ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—é
function assignProperty(index, ownerName, type) {
    let item;
    let collection;
    
    if (type === 'street') {
        collection = properties;
    } else if (type === 'railroad') {
        collection = railroads;
    } else {
        collection = utilities;
    }
    
    item = collection[index];
    
    if (ownerName === "") {
        item.owner = null;
        if (type === 'street') {
            item.houses = 0;
        } else {
            item.mortgaged = false;
        }
    } else {
        item.owner = ownerName;
        if (type !== 'street') {
            item.mortgaged = false;
        }
    }
    
    updateGameAndSave();
}

// –ó–≤—ñ–ª—å–Ω–∏—Ç–∏ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å
function freeProperty(index, type) {
    if (type === 'street') {
        properties[index].owner = null;
        properties[index].houses = 0;
    } else if (type === 'railroad') {
        railroads[index].owner = null;
        railroads[index].mortgaged = false;
    } else {
        utilities[index].owner = null;
        utilities[index].mortgaged = false;
    }
    updateGameAndSave();
}

// –î–æ–¥–∞—Ç–∏ –±—É–¥–∏–Ω–æ–∫
function addHouse(index) {
    const property = properties[index];
    
    if (property.houses < 4 && checkMonopoly(property.group, property.owner)) {
        property.houses++;
        updateGameAndSave();
    }
}

// –í–∏–¥–∞–ª–∏—Ç–∏ –±—É–¥–∏–Ω–æ–∫
function removeHouse(index) {
    const property = properties[index];
    
    if (property.houses > 0) {
        property.houses--;
        updateGameAndSave();
    }
}

// –î–æ–¥–∞—Ç–∏ –≥–æ—Ç–µ–ª—å
function addHotel(index) {
    const property = properties[index];
    
    if (property.houses === 4 && checkMonopoly(property.group, property.owner)) {
        property.houses = 5;
        updateGameAndSave();
    }
}

// –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–ª–æ–≥—É
function toggleMortgage(index, type) {
    let item;
    
    if (type === 'railroad') {
        item = railroads[index];
    } else {
        item = utilities[index];
    }
    
    item.mortgaged = !item.mortgaged;
    updateGameAndSave();
}

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –º–æ–Ω–æ–ø–æ–ª—ñ—é
function checkMonopoly(group, owner) {
    if (!owner) return false;
    
    const groupProperties = properties.filter(p => p.group === group);
    const ownedProperties = groupProperties.filter(p => p.owner === owner);
    
    return groupProperties.length === ownedProperties.length;
}

// –ü—ñ–¥—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–æ–∫–∑–∞–ª—ñ–≤ —É –≤–ª–∞—Å–Ω–∏–∫–∞
function countRailroadsByOwner(ownerName) {
    return railroads.filter(r => r.owner === ownerName && !r.mortgaged).length;
}

// –ü—ñ–¥—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π —É –≤–ª–∞—Å–Ω–∏–∫–∞
function countUtilitiesByOwner(ownerName) {
    return utilities.filter(u => u.owner === ownerName && !u.mortgaged).length;
}

// –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ—Ä–µ–Ω–¥—É –∑–∞ –≤–æ–∫–∑–∞–ª
function calculateRailroadRent(ownerName) {
    if (!ownerName) return 0;
    
    const count = countRailroadsByOwner(ownerName);
    
    switch(count) {
        case 1: return 25;
        case 2: return 50;
        case 3: return 100;
        case 4: return 200;
        default: return 0;
    }
}

// –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ—Ä–µ–Ω–¥—É –∑–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é (–ø—Ä–∏ –∑–∞–¥–∞–Ω—ñ–π —Å—É–º—ñ –∫—É–±–∏–∫—ñ–≤)
function calculateUtilityRent(ownerName, diceSum) {
    if (!ownerName || !diceSum) return 0;
    
    const count = countUtilitiesByOwner(ownerName);
    
    if (count === 1) {
        return diceSum * 4;
    } else if (count === 2) {
        return diceSum * 10;
    }
    
    return 0;
}

// –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –æ—Ä–µ–Ω–¥—É –¥–ª—è –≤—É–ª–∏—Ü—ñ
function calculateCurrentRent(property) {
    if (!property.owner) return 0;
    
    const isMonopoly = checkMonopoly(property.group, property.owner);
    
    // –Ø–∫—â–æ –º–æ–Ω–æ–ø–æ–ª—ñ—è —ñ –Ω–µ–º–∞—î –±—É–¥–∏–Ω–∫—ñ–≤ - –æ—Ä–µ–Ω–¥–∞ –ø–æ–¥–≤–æ—é—î—Ç—å—Å—è
    if (isMonopoly && property.houses === 0) {
        return property.rent[0] * 2;
    }
    
    // –ó –±—É–¥–∏–Ω–∫–∞–º–∏/–≥–æ—Ç–µ–ª—è–º–∏
    return property.rent[property.houses];
}

// –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–ª—ñ—Ä –≥—Ä–∞–≤—Ü—è
function getPlayerColor(playerName) {
    const player = players.find(p => p.name === playerName);
    return player ? player.color : '#cccccc';
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É –≤—É–ª–∏—Ü—ñ
function showPropertyCard(index) {
    const property = properties[index];
    const isMonopoly = checkMonopoly(property.group, property.owner);
    const currentRent = calculateCurrentRent(property);
    
    let content = `
        <div style="text-align: left;">
            <div style="background: ${property.color}; color: white; padding: 20px; border-radius: 15px 15px 0 0; margin: -25px -25px 20px -25px;">
                <h2 style="margin: 0; color: white;">üèòÔ∏è ${property.name}</h2>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í–ª–∞—Å–Ω–∏–∫</div>
                    <div class="stat-value">${property.owner || "–ù–µ–º–∞—î"}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                    <div class="stat-value">${property.price} ‚Ç¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ë—É–¥–∏–Ω–æ–∫</div>
                    <div class="stat-value">${property.houseCost} ‚Ç¥</div>
                </div>
            </div>
            
            ${isMonopoly ? '<div style="background: gold; color: #2c3e50; padding: 15px; border-radius: 10px; font-weight: 800; margin: 20px 0; text-align: center;">‚≠ê –ú–û–ù–û–ü–û–õ–Ü–Ø ‚≠ê</div>' : ''}
            
            <h3>üí∞ –¢–∞–±–ª–∏—Ü—è –æ—Ä–µ–Ω–¥–∏</h3>
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                <tr style="background: #f8f9fa;"><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">–ë–µ–∑ –±—É–¥–∏–Ω–∫—ñ–≤</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; font-weight: 800; text-align: right;">${property.rent[0]} ‚Ç¥</td></tr>
                <tr><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">1 –±—É–¥–∏–Ω–æ–∫</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">${property.rent[1]} ‚Ç¥</td></tr>
                <tr style="background: #f8f9fa;"><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">2 –±—É–¥–∏–Ω–∫–∏</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">${property.rent[2]} ‚Ç¥</td></tr>
                <tr><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">3 –±—É–¥–∏–Ω–∫–∏</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">${property.rent[3]} ‚Ç¥</td></tr>
                <tr style="background: #f8f9fa;"><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">4 –±—É–¥–∏–Ω–∫–∏</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">${property.rent[4]} ‚Ç¥</td></tr>
                <tr><td style="padding: 12px;">üè® –ì–æ—Ç–µ–ª—å</td><td style="padding: 12px; font-weight: 800; text-align: right;">${property.rent[5]} ‚Ç¥</td></tr>
            </table>
            
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                <div style="font-size: 0.9em; opacity: 0.9;">–ü–æ—Ç–æ—á–Ω–∞ –æ—Ä–µ–Ω–¥–∞</div>
                <div style="font-size: 2.5em; font-weight: 800; margin: 10px 0;">${currentRent} ‚Ç¥</div>
                <div style="font-size: 0.9em;">
                    ${property.owner ? `üí∞ –ì—Ä–∞–≤–µ—Ü—å ${property.owner} –æ—Ç—Ä–∏–º—É—î ${currentRent} ‚Ç¥` : "üÜì –í—ñ–ª—å–Ω–∞ –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ"}
                </div>
            </div>
        </div>`;
    
    showCard(property.name, content);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É –≤–æ–∫–∑–∞–ª—É
function showRailroadCard(index) {
    const railroad = railroads[index];
    const rent = calculateRailroadRent(railroad.owner);
    const ownerCount = countRailroadsByOwner(railroad.owner);
    
    let content = `
        <div style="text-align: left;">
            <div style="background: ${railroad.color}; color: white; padding: 20px; border-radius: 15px 15px 0 0; margin: -25px -25px 20px -25px;">
                <h2 style="margin: 0; color: white;">${railroad.icon} ${railroad.name}</h2>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í–ª–∞—Å–Ω–∏–∫</div>
                    <div class="stat-value">${railroad.owner || "–ù–µ–º–∞—î"}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                    <div class="stat-value">${railroad.price} ‚Ç¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ó–∞–ª–æ–≥</div>
                    <div class="stat-value">${railroad.mortgage} ‚Ç¥</div>
                </div>
            </div>
            
            ${railroad.mortgaged ? '<div style="background: #ff416c; color: white; padding: 15px; border-radius: 10px; font-weight: 800; margin: 20px 0; text-align: center;">üìâ –ó–ê–ö–õ–ê–î–ï–ù–ò–ô (–Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É)</div>' : ''}
            
            <h3>üöÇ –û—Ä–µ–Ω–¥–∞ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –≤–æ–∫–∑–∞–ª—ñ–≤</h3>
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                <tr style="background: #f8f9fa;"><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">1 –≤–æ–∫–∑–∞–ª</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; font-weight: 800; text-align: right;">25 ‚Ç¥</td></tr>
                <tr><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">2 –≤–æ–∫–∑–∞–ª–∏</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">50 ‚Ç¥</td></tr>
                <tr style="background: #f8f9fa;"><td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">3 –≤–æ–∫–∑–∞–ª–∏</td><td style="padding: 12px; border-bottom: 1px solid #e0e0e0; text-align: right;">100 ‚Ç¥</td></tr>
                <tr><td style="padding: 12px;">4 –≤–æ–∫–∑–∞–ª–∏</td><td style="padding: 12px; font-weight: 800; text-align: right;">200 ‚Ç¥</td></tr>
            </table>
            
            <div style="background: ${railroad.color}; color: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                <div style="font-size: 0.9em; opacity: 0.9;">–ü–æ—Ç–æ—á–Ω–∞ –æ—Ä–µ–Ω–¥–∞</div>
                <div style="font-size: 2.5em; font-weight: 800; margin: 10px 0;">${rent} ‚Ç¥</div>
                <div style="font-size: 0.9em;">
                    ${railroad.owner ? `üëë –ì—Ä–∞–≤–µ—Ü—å ${railroad.owner} –º–∞—î ${ownerCount} –≤–æ–∫–∑–∞–ª—ñ–≤` : "üÜì –í—ñ–ª—å–Ω–∏–π –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ"}
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9em;">
                <strong>üìå –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –≤–æ–∫–∑–∞–ª—ñ–≤:</strong><br>
                ‚Ä¢ –ù–µ –º–æ–∂–Ω–∞ –±—É–¥—É–≤–∞—Ç–∏ –±—É–¥–∏–Ω–∫–∏/–≥–æ—Ç–µ–ª—ñ<br>
                ‚Ä¢ –û—Ä–µ–Ω–¥–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤–æ–∫–∑–∞–ª—ñ–≤<br>
                ‚Ä¢ –ó–∞–∫–ª–∞–¥–µ–Ω–∏–π –≤–æ–∫–∑–∞–ª –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É
            </div>
        </div>`;
    
    showCard(railroad.name, content);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
function showUtilityCard(index) {
    const utility = utilities[index];
    const ownerCount = countUtilitiesByOwner(utility.owner);
    
    let content = `
        <div style="text-align: left;">
            <div style="background: ${utility.color}; color: white; padding: 20px; border-radius: 15px 15px 0 0; margin: -25px -25px 20px -25px;">
                <h2 style="margin: 0; color: white;">${utility.icon} ${utility.name}</h2>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í–ª–∞—Å–Ω–∏–∫</div>
                    <div class="stat-value">${utility.owner || "–ù–µ–º–∞—î"}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í–∞—Ä—Ç—ñ—Å—Ç—å</div>
                    <div class="stat-value">${utility.price} ‚Ç¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ó–∞–ª–æ–≥</div>
                    <div class="stat-value">${utility.mortgage} ‚Ç¥</div>
                </div>
            </div>
            
            ${utility.mortgaged ? '<div style="background: #ff416c; color: white; padding: 15px; border-radius: 10px; font-weight: 800; margin: 20px 0; text-align: center;">üìâ –ó–ê–ö–õ–ê–î–ï–ù–ê (–Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É)</div>' : ''}
            
            <h3>‚ö° –û—Ä–µ–Ω–¥–∞ –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π</h3>
            <div style="background: #e3f2fd; padding: 20px; border-radius: 15px; margin: 15px 0;">
                <div style="font-size: 1.2em; font-weight: 800; margin-bottom: 10px;">üé≤ –§–æ—Ä–º—É–ª–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</div>
                <div style="margin: 10px 0; padding: 15px; background: white; border-radius: 10px;">
                    <strong>1 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è:</strong><br>
                    (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó 4
                </div>
                <div style="margin: 10px 0; padding: 15px; background: white; border-radius: 10px;">
                    <strong>2 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó:</strong><br>
                    (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó 10
                </div>
            </div>
            
            <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0;">
                <strong>üìä –ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</strong><br>
                –í–∏–ø–∞–ª–æ –Ω–∞ –∫—É–±–∏–∫–∞—Ö: 7 –æ—á–æ–∫<br>
                1 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è ‚Üí 7 √ó 4 = <strong>28 ‚Ç¥</strong><br>
                2 –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó ‚Üí 7 √ó 10 = <strong>70 ‚Ç¥</strong>
            </div>
            
            <div style="background: ${utility.color}; color: white; padding: 20px; border-radius: 15px; margin-top: 20px;">
                <div style="font-size: 0.9em; opacity: 0.9;">–ü–æ—Ç–æ—á–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è</div>
                <div style="font-size: 2em; font-weight: 800; margin: 10px 0;">
                    ${utility.owner ? `üëë ${utility.owner} –º–∞—î ${ownerCount} –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π` : "üÜì –í—ñ–ª—å–Ω–∞ –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ"}
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9em;">
                <strong>üìå –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π:</strong><br>
                ‚Ä¢ –ù–µ –º–æ–∂–Ω–∞ –±—É–¥—É–≤–∞—Ç–∏ –±—É–¥–∏–Ω–∫–∏/–≥–æ—Ç–µ–ª—ñ<br>
                ‚Ä¢ –û—Ä–µ–Ω–¥–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å—É–º–∏ –∫—É–±–∏–∫—ñ–≤<br>
                ‚Ä¢ –ó–∞–∫–ª–∞–¥–µ–Ω–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É<br>
                ‚Ä¢ –ê—É–∫—Ü—ñ–æ–Ω, —è–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–µ –∫—É–ø—É—î
            </div>
        </div>`;
    
    showCard(utility.name, content);
}

// –ö–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫–∏
function rollDice() {
    const dice1 = Math.floor(Math.random() * 6) + 1;
    const dice2 = Math.floor(Math.random() * 6) + 1;
    const sum = dice1 + dice2;
    
    document.getElementById('dice1').textContent = dice1;
    document.getElementById('dice2').textContent = dice2;
    
    let resultHTML = `
        <div style="font-size: 1.2em; margin: 10px 0;">
            üé≤ –°—É–º–∞: <strong>${sum}</strong> (${dice1} + ${dice2})
        </div>
    `;
    
    // –î–æ–¥–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
    players.forEach(player => {
        const utilityCount = countUtilitiesByOwner(player.name);
        if (utilityCount > 0) {
            const rent = calculateUtilityRent(player.name, sum);
            resultHTML += `
                <div style="background: ${player.color}20; padding: 10px; border-radius: 10px; margin: 5px 0; border-left: 4px solid ${player.color}">
                    üëë ${player.name}: ${utilityCount} –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π ‚Üí –æ—Ä–µ–Ω–¥–∞: <strong>${rent} ‚Ç¥</strong><br>
                    <small>(${sum} √ó ${utilityCount === 1 ? '4' : '10'} = ${rent} ‚Ç¥)</small>
                </div>
            `;
        }
    });
    
    document.getElementById('diceResult').innerHTML = resultHTML;
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –≤—É–ª–∏—Ü—ñ —Ç–∞ –≤–æ–∫–∑–∞–ª–∏
function showAllProperties() {
    let content = "<div style='text-align: left;'>";
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    content += `<h2 style="text-align: center;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ</h2>`;
    
    content += `<div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">–í—É–ª–∏—Ü—å</div>
            <div class="stat-value">${properties.length}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–í–æ–∫–∑–∞–ª—ñ–≤</div>
            <div class="stat-value">${railroads.length}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π</div>
            <div class="stat-value">${utilities.length}</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">–í—Å—å–æ–≥–æ</div>
            <div class="stat-value">${properties.length + railroads.length + utilities.length}</div>
        </div>
    </div>`;
    
    // –í—É–ª–∏—Ü—ñ
    content += "<h3>üèòÔ∏è –í—É–ª–∏—Ü—ñ</h3>";
    
    // –ì—Ä—É–ø—É—î–º–æ –∑–∞ –∫–æ–ª—å–æ—Ä–∞–º–∏
    const groups = {};
    properties.forEach(property => {
        if (!groups[property.group]) {
            groups[property.group] = [];
        }
        groups[property.group].push(property);
    });
    
    // –°–æ—Ä—Ç—É—î–º–æ –≥—Ä—É–ø–∏ –∑–∞ –ª–æ–≥—ñ—á–Ω–∏–º –ø–æ—Ä—è–¥–∫–æ–º
    const groupOrder = ['brown', 'lightblue', 'pink', 'orange', 'red', 'yellow', 'green', 'blue'];
    
    groupOrder.forEach(group => {
        if (groups[group]) {
            const groupProperties = groups[group];
            const color = groupProperties[0].color;
            const groupNames = {
                'brown': '–ö–æ—Ä–∏—á–Ω–µ–≤–∞',
                'lightblue': '–ë–ª–∞–∫–∏—Ç–Ω–∞', 
                'pink': '–†–æ–∂–µ–≤–∞',
                'orange': '–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∞',
                'red': '–ß–µ—Ä–≤–æ–Ω–∞',
                'yellow': '–ñ–æ–≤—Ç–∞',
                'green': '–ó–µ–ª–µ–Ω–∞',
                'blue': '–°–∏–Ω—è'
            };
            
            content += `
                <div style="border: 2px solid ${color}; border-radius: 15px; margin-bottom: 20px; overflow: hidden;">
                    <div style="background: ${color}; color: white; padding: 12px; font-weight: 800;">
                        ${groupNames[group]} (${groupProperties.length} –≤—É–ª–∏—Ü—å)
                    </div>
                    <div style="padding: 15px;">
                        ${groupProperties.map(p => `
                            <div style="margin: 10px 0; padding: 12px; background: ${p.owner ? getPlayerColor(p.owner)+'20' : '#f8f9fa'}; border-radius: 10px; border-left: 4px solid ${p.owner ? getPlayerColor(p.owner) : '#ccc'};">
                                <strong>${p.name}</strong> - ${p.price} ‚Ç¥
                                ${p.owner ? `<br><small>üëë ${p.owner}, üè† ${p.houses}, üí∞ ${calculateCurrentRent(p)} ‚Ç¥</small>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }
    });
    
    // –í–æ–∫–∑–∞–ª–∏
    content += "<h3>üöÇ –í–æ–∫–∑–∞–ª–∏</h3>";
    railroads.forEach((rr, i) => {
        const rent = calculateRailroadRent(rr.owner);
        content += `
            <div style="margin: 10px 0; padding: 15px; background: ${rr.owner ? getPlayerColor(rr.owner)+'20' : '#f8f9fa'}; border-radius: 10px; border-left: 4px solid ${rr.color};">
                <strong>${rr.icon} ${rr.name}</strong> - ${rr.price} ‚Ç¥
                ${rr.owner ? `<br><small>üëë ${rr.owner}, üí∞ ${rent} ‚Ç¥ ${rr.mortgaged ? '(–∑–∞–∫–ª–∞–¥–µ–Ω–∏–π)' : ''}</small>` : ''}
            </div>`;
    });
    
    // –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
    content += "<h3>‚ö° –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó</h3>";
    utilities.forEach((util, i) => {
        content += `
            <div style="margin: 10px 0; padding: 15px; background: ${util.owner ? getPlayerColor(util.owner)+'20' : '#f8f9fa'}; border-radius: 10px; border-left: 4px solid ${util.color};">
                <strong>${util.icon} ${util.name}</strong> - ${util.price} ‚Ç¥
                ${util.owner ? `<br><small>üëë ${util.owner} ${util.mortgaged ? '(–∑–∞–∫–ª–∞–¥–µ–Ω–∞)' : ''}</small>` : ''}
            </div>`;
    });
    
    content += "</div>";
    showCard("–í—Å—è –≤–ª–∞—Å–Ω—ñ—Å—Ç—å", content);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É —à–∞–Ω—Å—É
function openChance() {
    const chanceCards = [
        "–ü—Ä–æ–π–¥—ñ—Ç—å –Ω–∞ –°—Ç–∞—Ä—Ç. –û—Ç—Ä–∏–º–∞–π—Ç–µ 200 ‚Ç¥.",
        "–ë–∞–Ω–∫ –≤–∏–ø–ª–∞—á—É—î –≤–∞–º –¥–∏–≤—ñ–¥–µ–Ω–¥–∏ —É —Ä–æ–∑–º—ñ—Ä—ñ 50 ‚Ç¥.",
        "–í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤–∏–≥—Ä–∞—à —É –ª–æ—Ç–µ—Ä–µ—é. –û—Ç—Ä–∏–º–∞–π—Ç–µ 100 ‚Ç¥.",
        "–ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –∑ –≤'—è–∑–Ω–∏—Ü—ñ. –¶—è –∫–∞—Ä—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç—É.",
        "–í—ñ–¥–ø—Ä–∞–≤–ª—è–π—Ç–µ—Å—å —É –≤'—è–∑–Ω–∏—Ü—é. –ü—Ä—è–º–æ —É –≤'—è–∑–Ω–∏—Ü—é, –Ω–µ –ø—Ä–æ—Ö–æ–¥—å—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª, –Ω–µ –æ—Ç—Ä–∏–º—É–π—Ç–µ 200 ‚Ç¥.",
        "–û–ø–ª–∞—Ç—ñ—Ç—å —à—Ç—Ä–∞—Ñ –∑–∞ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ ‚Äî 15 ‚Ç¥.",
        "–†–µ–º–æ–Ω—Ç –≤—É–ª–∏—Ü—å. –ó–∞ –∫–æ–∂–µ–Ω –±—É–¥–∏–Ω–æ–∫ –∑–∞–ø–ª–∞—Ç–∏—Ç–µ 25 ‚Ç¥, –∑–∞ –∫–æ–∂–µ–Ω –≥–æ—Ç–µ–ª—å ‚Äî 100 ‚Ç¥.",
        "–ê–≤–∞–Ω—Å —É —Ä–æ–∑–º—ñ—Ä—ñ 100 ‚Ç¥."
    ];
    
    const randomCard = chanceCards[Math.floor(Math.random() * chanceCards.length)];
    showCard("üé≤ –®–∞–Ω—Å", `<div style="padding: 30px; font-size: 1.3em; line-height: 1.5;">${randomCard}</div>`);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É —Å—É—Å–ø—ñ–ª—å–Ω–æ—ó –∫–∞–∑–Ω–∏
function openCommunity() {
    const communityCards = [
        "–ü–æ–º–∏–ª–∫–∞ –±–∞–Ω–∫—É –Ω–∞ –≤–∞—à—É –∫–æ—Ä–∏—Å—Ç—å. –û—Ç—Ä–∏–º–∞–π—Ç–µ 200 ‚Ç¥.",
        "–û–ø–ª–∞—Ç—ñ—Ç—å –ª—ñ–∫–∞—Ä–Ω—è–Ω–∏–π –∑–±—ñ—Ä 100 ‚Ç¥.",
        "–í–∏ –∑–∞–π–Ω—è–ª–∏ –¥—Ä—É–≥–µ –º—ñ—Å—Ü–µ –≤ –∫–æ–Ω–∫—É—Ä—Å—ñ –∫—Ä–∞—Å–∏. –û—Ç—Ä–∏–º–∞–π—Ç–µ 10 ‚Ç¥.",
        "–ù–∞ –¥–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –∫–æ–∂–µ–Ω –≥—Ä–∞–≤–µ—Ü—å –¥–∞—Ä—É—î –≤–∞–º 10 ‚Ç¥.",
        "–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–æ–¥–∞—Ç–∫—É. –û—Ç—Ä–∏–º–∞–π—Ç–µ 20 ‚Ç¥.",
        "–û–ø–ª–∞—Ç—ñ—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É ‚Äî 50 ‚Ç¥.",
        "–ó–±—ñ—Ä –Ω–∞ –†—ñ–∑–¥–≤–æ. –û—Ç—Ä–∏–º–∞–π—Ç–µ 100 ‚Ç¥ –≤—ñ–¥ –∫–æ–∂–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è.",
        "–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Å–ø–∞–¥—â–∏–Ω—É. –û—Ç—Ä–∏–º–∞–π—Ç–µ 100 ‚Ç¥."
    ];
    
    const randomCard = communityCards[Math.floor(Math.random() * communityCards.length)];
    showCard("üì¶ –°—É—Å–ø—ñ–ª—å–Ω–∞ –∫–∞–∑–Ω–∞", `<div style="padding: 30px; font-size: 1.3em; line-height: 1.5;">${randomCard}</div>`);
}

// –í–∏—Ç—è–≥–Ω—É—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—É –∫–∞—Ä—Ç–∫—É
function drawTransportCard() {
    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∫–∞—Ä—Ç–∏
    const availableCards = transportCards.filter((card, index) => !transportCardsUsed.includes(index));
    
    if (availableCards.length === 0) {
        // –Ø–∫—â–æ –≤—Å—ñ –∫–∞—Ä—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ, —Å–∫–∏–¥–∞—î–º–æ
        transportCardsUsed = [];
        drawTransportCard();
        return;
    }
    
    const randomIndex = Math.floor(Math.random() * availableCards.length);
    const card = availableCards[randomIndex];
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —ñ–Ω–¥–µ–∫—Å –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏
    const originalIndex = transportCards.findIndex(c => c === card);
    transportCardsUsed.push(originalIndex);
    
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –∫–∞—Ä—Ç
    saveGame();
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–∞—Ä—Ç–∫—É
    let cardInfo = `
        <div style="text-align: left;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin: -25px -25px 25px -25px;">
                <h2 style="margin: 0; color: white;">üöó ${card.name}</h2>
            </div>
            
            <div style="font-size: 1.2em; line-height: 1.5; margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                ${card.description}
            </div>
            
            <div style="background: #e8f5e9; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                <div style="font-weight: 800; margin-bottom: 10px; color: #2e7d32;">üéØ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</div>
                ${card.type === 'control' ? `
                    1. –ú–æ–∂–Ω–∞ –ø–æ—ó—Ö–∞—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫—É –∫–ª—ñ—Ç–∏–Ω–∫—É –ø–æ–ª—è<br>
                    2. –Ø–∫—â–æ –ø—Ä–æ—ó–∂–¥–∂–∞—î—à ¬´–°—Ç–∞—Ä—Ç¬ª ‚Äî +200 –ù–ï –æ—Ç—Ä–∏–º—É—î—à<br>
                    3. –ö–∞—Ä—Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è
                ` : card.type === 'free' ? `
                    1. –ö–∞—Ä—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è<br>
                    2. –î–æ–∑–≤–æ–ª—è—î –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –ø—Ä–æ—ó—Ö–∞—Ç–∏ –¥–æ –±—É–¥—å-—è–∫–æ—ó —Ç–æ—á–∫–∏<br>
                    3. –ú–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –≤ –±—É–¥—å-—è–∫–∏–π –º–æ–º–µ–Ω—Ç
                ` : card.type === 'pay' ? `
                    1. –ù–µ–≥–∞–π–Ω–æ —Å–ø–ª–∞—Ç–∏—Ç–∏ –∑–∞–∑–Ω–∞—á–µ–Ω—É —Å—É–º—É<br>
                    2. –Ø–∫—â–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–æ—à–µ–π ‚Äî –ø—Ä–æ–¥–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ—Å—Ç—å<br>
                    3. –ö–∞—Ä—Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É
                ` : `
                    1. –ù–µ–≥–∞–π–Ω–æ –ø—Ä—è–º—É–π—Ç–µ –¥–æ –≤'—è–∑–Ω–∏—Ü—ñ<br>
                    2. –ù–µ –ø—Ä–æ—Ö–æ–¥—å—Ç–µ —á–µ—Ä–µ–∑ –°—Ç–∞—Ä—Ç<br>
                    3. –ù–µ –æ—Ç—Ä–∏–º—É–π—Ç–µ 200 ‚Ç¥
                `}
            </div>
        </div>`;
    
    showCard("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞ –∫–∞—Ä—Ç–∞", cardInfo);
}

// –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É
function showCard(title, content) {
    document.getElementById("cardTitle").innerHTML = title;
    document.getElementById("cardContent").innerHTML = content;
    document.getElementById("card").classList.remove("hidden");
    document.getElementById("overlay").classList.remove("hidden");
}

// –ó–∞–∫—Ä–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É
function closeCard() {
    document.getElementById("card").classList.add("hidden");
    document.getElementById("overlay").classList.add("hidden");
}

// –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –æ—Ä–µ–Ω–¥–∏
function populateRentCalculator() {
    const select = document.getElementById("calcSelect");
    select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—ñ—Å—Ç—å</option>';
    
    // –î–æ–¥–∞—î–º–æ –≤—É–ª–∏—Ü—ñ
    properties.forEach((prop, index) => {
        select.innerHTML += `<option value="street_${index}">üèòÔ∏è ${prop.name} (${prop.owner || "–≤—ñ–ª—å–Ω–∞"})</option>`;
    });
    
    // –î–æ–¥–∞—î–º–æ –≤–æ–∫–∑–∞–ª–∏
    railroads.forEach((rr, index) => {
        select.innerHTML += `<option value="railroad_${index}">${rr.icon} ${rr.name} (${rr.owner || "–≤—ñ–ª—å–Ω–∏–π"})</option>`;
    });
    
    // –î–æ–¥–∞—î–º–æ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó
    utilities.forEach((util, index) => {
        select.innerHTML += `<option value="utility_${index}">${util.icon} ${util.name} (${util.owner || "–≤—ñ–ª—å–Ω–∞"})</option>`;
    });
}

// –û–Ω–æ–≤–∏—Ç–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ä–µ–Ω–¥–∏
function updateRentCalculator() {
    const typeSelect = document.getElementById("calcSelectType");
    const select = document.getElementById("calcSelect");
    
    select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—ñ—Å—Ç—å</option>';
    
    if (typeSelect.value === 'street') {
        properties.forEach((prop, index) => {
            select.innerHTML += `<option value="street_${index}">üèòÔ∏è ${prop.name} (${prop.owner || "–≤—ñ–ª—å–Ω–∞"})</option>`;
        });
    } else if (typeSelect.value === 'railroad') {
        railroads.forEach((rr, index) => {
            select.innerHTML += `<option value="railroad_${index}">${rr.icon} ${rr.name} (${rr.owner || "–≤—ñ–ª—å–Ω–∏–π"})</option>`;
        });
    } else {
        utilities.forEach((util, index) => {
            select.innerHTML += `<option value="utility_${index}">${util.icon} ${util.name} (${util.owner || "–≤—ñ–ª—å–Ω–∞"})</option>`;
        });
    }
    
    calculateRentForSelected();
}

// –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ—Ä–µ–Ω–¥—É –¥–ª—è –æ–±—Ä–∞–Ω–æ—ó –≤–ª–∞—Å–Ω–æ—Å—Ç—ñ
function calculateRentForSelected() {
    const select = document.getElementById("calcSelect");
    const resultDiv = document.getElementById("rentResult");
    
    if (!select.value) {
        resultDiv.innerHTML = "<div style='text-align: center; padding: 20px; color: #666;'>–û–±–µ—Ä—ñ—Ç—å –≤–ª–∞—Å–Ω—ñ—Å—Ç—å –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –æ—Ä–µ–Ω–¥–∏</div>";
        return;
    }
    
    const [type, indexStr] = select.value.split("_");
    const index = parseInt(indexStr);
    
    if (type === 'street') {
        const property = properties[index];
        const rent = calculateCurrentRent(property);
        const isMonopoly = checkMonopoly(property.group, property.owner);
        
        if (!property.owner) {
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">üèòÔ∏è ${property.name}</div>
                    <div style="color: #4CAF50; font-weight: 600; margin: 10px 0;">üÜì –í—ñ–ª—å–Ω–∞ –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ</div>
                    <div style="font-size: 1.5em; font-weight: 800; color: #667eea; margin: 15px 0;">${property.price} ‚Ç¥</div>
                    <small>–ë–∞–∑–æ–≤–∞ –æ—Ä–µ–Ω–¥–∞: ${property.rent[0]} ‚Ç¥</small>
                </div>
            `;
        } else {
            let monopolyInfo = "";
            if (isMonopoly && property.houses === 0) {
                monopolyInfo = `<div style="background: gold; color: #2c3e50; padding: 10px; border-radius: 10px; font-weight: 800; margin: 10px 0; text-align: center;">‚≠ê –ú–û–ù–û–ü–û–õ–Ü–Ø (–æ—Ä–µ–Ω–¥–∞ –ø–æ–¥–≤–æ—î–Ω–∞)</div>`;
            }
            
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">üèòÔ∏è ${property.name}</div>
                    <div style="color: ${getPlayerColor(property.owner)}; font-weight: 600; margin: 10px 0;">
                        üëë –í–ª–∞—Å–Ω–∏–∫: ${property.owner}
                    </div>
                    <div style="margin: 10px 0;">üè† –ë—É–¥–∏–Ω–∫–∏: ${property.houses === 5 ? 'üè® –ì–æ—Ç–µ–ª—å' : property.houses || '–ù–µ–º–∞—î'}</div>
                    ${monopolyInfo}
                    <div style="font-size: 2em; font-weight: 800; color: #2c3e50; margin: 15px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px;">
                        –û–†–ï–ù–î–ê: ${rent} ‚Ç¥
                    </div>
                    <small>–Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –∑—É–ø–∏–Ω–∏—Ç—å—Å—è —Ç—É—Ç, –≤—ñ–Ω –º–∞—î –∑–∞–ø–ª–∞—Ç–∏—Ç–∏ ${rent} ‚Ç¥ –≥—Ä–∞–≤—Ü—é ${property.owner}</small>
                </div>
            `;
        }
    } else if (type === 'railroad') {
        const railroad = railroads[index];
        const rent = calculateRailroadRent(railroad.owner);
        const ownerCount = countRailroadsByOwner(railroad.owner);
        
        if (!railroad.owner) {
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">${railroad.icon} ${railroad.name}</div>
                    <div style="color: #4CAF50; font-weight: 600; margin: 10px 0;">üÜì –í—ñ–ª—å–Ω–∏–π –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ</div>
                    <div style="font-size: 1.5em; font-weight: 800; color: #667eea; margin: 15px 0;">${railroad.price} ‚Ç¥</div>
                    <small>–û—Ä–µ–Ω–¥–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤–æ–∫–∑–∞–ª—ñ–≤ —É –≤–ª–∞—Å–Ω–∏–∫–∞</small>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">${railroad.icon} ${railroad.name}</div>
                    <div style="color: ${getPlayerColor(railroad.owner)}; font-weight: 600; margin: 10px 0;">
                        üëë –í–ª–∞—Å–Ω–∏–∫: ${railroad.owner}
                    </div>
                    ${railroad.mortgaged ? '<div style="background: #ff416c; color: white; padding: 10px; border-radius: 10px; font-weight: 800; margin: 10px 0;">üìâ –ó–ê–ö–õ–ê–î–ï–ù–ò–ô</div>' : ''}
                    <div style="margin: 10px 0;">üöÇ –£ –≤–ª–∞—Å–Ω–∏–∫–∞: ${ownerCount} –≤–æ–∫–∑–∞–ª${ownerCount !== 1 ? '–∏' : ''}</div>
                    <div style="font-size: 2em; font-weight: 800; color: #2c3e50; margin: 15px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px;">
                        –û–†–ï–ù–î–ê: ${rent} ‚Ç¥
                    </div>
                    <small>${railroad.mortgaged ? '–ó–∞–∫–ª–∞–¥–µ–Ω–∏–π –≤–æ–∫–∑–∞–ª –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É' : `–Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –∑—É–ø–∏–Ω–∏—Ç—å—Å—è —Ç—É—Ç, –≤—ñ–Ω –º–∞—î –∑–∞–ø–ª–∞—Ç–∏—Ç–∏ ${rent} ‚Ç¥ –≥—Ä–∞–≤—Ü—é ${railroad.owner}`}</small>
                </div>
            `;
        }
    } else {
        const utility = utilities[index];
        const ownerCount = countUtilitiesByOwner(utility.owner);
        
        if (!utility.owner) {
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">${utility.icon} ${utility.name}</div>
                    <div style="color: #4CAF50; font-weight: 600; margin: 10px 0;">üÜì –í—ñ–ª—å–Ω–∞ –¥–ª—è –∫—É–ø—ñ–≤–ª—ñ</div>
                    <div style="font-size: 1.5em; font-weight: 800; color: #667eea; margin: 15px 0;">${utility.price} ‚Ç¥</div>
                    <small>–û—Ä–µ–Ω–¥–∞: (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó ${ownerCount === 1 ? '4' : '10'}</small>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.3em; font-weight: 800; margin-bottom: 10px;">${utility.icon} ${utility.name}</div>
                    <div style="color: ${getPlayerColor(utility.owner)}; font-weight: 600; margin: 10px 0;">
                        üëë –í–ª–∞—Å–Ω–∏–∫: ${utility.owner}
                    </div>
                    ${utility.mortgaged ? '<div style="background: #ff416c; color: white; padding: 10px; border-radius: 10px; font-weight: 800; margin: 10px 0;">üìâ –ó–ê–ö–õ–ê–î–ï–ù–ê</div>' : ''}
                    <div style="margin: 10px 0;">‚ö° –£ –≤–ª–∞—Å–Ω–∏–∫–∞: ${ownerCount} –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è</div>
                    <div style="font-size: 1.5em; font-weight: 800; color: #2c3e50; margin: 15px 0; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px;">
                        –§–æ—Ä–º—É–ª–∞: (—Å—É–º–∞ –∫—É–±–∏–∫—ñ–≤) √ó ${ownerCount === 1 ? '4' : '10'}
                    </div>
                    <small>${utility.mortgaged ? '–ó–∞–∫–ª–∞–¥–µ–Ω–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥—É' : `–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏ —Å—É–º—ñ –∫—É–±–∏–∫—ñ–≤ 7: 7 √ó ${ownerCount === 1 ? '4' : '10'} = ${ownerCount === 1 ? '28' : '70'} ‚Ç¥`}</small>
                </div>
            `;
        }
    }
}

// –°–∫–∏–Ω—É—Ç–∏ –≥—Ä—É
function resetGame() {
    if (confirm("–†–æ–∑–ø–æ—á–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É? –£—Å—ñ –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ.")) {
        clearSavedGame();
        startNewGame();
    }
}

// –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
function updateStats() {
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∞–≤—Ü—ñ–≤
    const playerStatsDiv = document.getElementById("playerStats");
    if (players.length > 0) {
        let statsHTML = `<div class="stats-grid">`;
        players.forEach(player => {
            const playerStreets = properties.filter(p => p.owner === player.name);
            const playerRailroads = railroads.filter(r => r.owner === player.name && !r.mortgaged);
            const playerUtilities = utilities.filter(u => u.owner === player.name && !u.mortgaged);
            
            statsHTML += `
                <div class="stat-card">
                    <div style="color: ${player.color}; font-weight: 800; margin-bottom: 10px;">${player.name}</div>
                    <div class="stat-value">${player.money} ‚Ç¥</div>
                    <div class="stat-label">üèòÔ∏è ${playerStreets.length} | üöÇ ${playerRailroads.length} | ‚ö° ${playerUtilities.length}</div>
                </div>
            `;
        });
        statsHTML += `</div>`;
        playerStatsDiv.innerHTML = statsHTML;
    }
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—É–ª–∏—Ü—å
    const streetStatsDiv = document.getElementById("streetStats");
    const ownedStreets = properties.filter(p => p.owner).length;
    const totalHouses = properties.reduce((sum, prop) => sum + (prop.houses < 5 ? prop.houses : 0), 0);
    const totalHotels = properties.filter(prop => prop.houses === 5).length;
    
    streetStatsDiv.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–í—Å—å–æ–≥–æ</div>
                <div class="stat-value">${properties.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ó–∞–π–Ω—è—Ç–æ</div>
                <div class="stat-value">${ownedStreets}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ë—É–¥–∏–Ω–∫–∏</div>
                <div class="stat-value">${totalHouses}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ì–æ—Ç–µ–ª—ñ</div>
                <div class="stat-value">${totalHotels}</div>
            </div>
        </div>
    `;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ–∫–∑–∞–ª—ñ–≤
    const railroadStatsDiv = document.getElementById("railroadStats");
    const ownedRailroads = railroads.filter(r => r.owner).length;
    const mortgagedRailroads = railroads.filter(r => r.mortgaged).length;
    
    railroadStatsDiv.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–í—Å—å–æ–≥–æ</div>
                <div class="stat-value">${railroads.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ó–∞–π–Ω—è—Ç–æ</div>
                <div class="stat-value">${ownedRailroads}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–í—ñ–ª—å–Ω–∏—Ö</div>
                <div class="stat-value">${railroads.length - ownedRailroads}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ó–∞–∫–ª–∞–¥–µ–Ω–æ</div>
                <div class="stat-value">${mortgagedRailroads}</div>
            </div>
        </div>
    `;
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π
    const utilityStatsDiv = document.getElementById("utilityStats");
    const ownedUtilities = utilities.filter(u => u.owner).length;
    const mortgagedUtilities = utilities.filter(u => u.mortgaged).length;
    
    utilityStatsDiv.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–í—Å—å–æ–≥–æ</div>
                <div class="stat-value">${utilities.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ó–∞–π–Ω—è—Ç–æ</div>
                <div class="stat-value">${ownedUtilities}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–í—ñ–ª—å–Ω–∏—Ö</div>
                <div class="stat-value">${utilities.length - ownedUtilities}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ó–∞–∫–ª–∞–¥–µ–Ω–æ</div>
                <div class="stat-value">${mortgagedUtilities}</div>
            </div>
        </div>
    `;
    
    // –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä–∏
    const gameStatsDiv = document.getElementById("gameStats");
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–±–∞–≥–∞—Ç—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è
    let richestPlayer = null;
    let maxWealth = 0;
    
    players.forEach(player => {
        const playerStreets = properties.filter(p => p.owner === player.name);
        const playerRailroads = railroads.filter(r => r.owner === player.name && !r.mortgaged);
        const playerUtilities = utilities.filter(u => u.owner === player.name && !u.mortgaged);
        const streetValue = playerStreets.reduce((sum, prop) => sum + prop.price, 0);
        const railroadValue = playerRailroads.reduce((sum, rr) => sum + rr.price, 0);
        const utilityValue = playerUtilities.reduce((sum, util) => sum + util.price, 0);
        const totalWealth = player.money + streetValue + railroadValue + utilityValue;
        
        if (totalWealth > maxWealth) {
            maxWealth = totalWealth;
            richestPlayer = player.name;
        }
    });
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –º–æ–Ω–æ–ø–æ–ª—ñ—ó
    const monopolies = [];
    const groups = ["brown", "lightblue", "pink", "orange", "red", "yellow", "green", "blue"];
    
    groups.forEach(group => {
        const groupProperties = properties.filter(p => p.group === group);
        if (groupProperties.length > 0) {
            const owners = [...new Set(groupProperties.map(p => p.owner).filter(o => o))];
            if (owners.length === 1 && owners[0]) {
                monopolies.push({
                    group: groupProperties[0].name.split(" ")[0], 
                    owner: owners[0], 
                    color: groupProperties[0].color,
                    fullGroupName: getGroupName(group)
                });
            }
        }
    });
    
    gameStatsDiv.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–ù–∞–π–±–∞–≥–∞—Ç—à–∏–π</div>
                <div class="stat-value">${richestPlayer || "-"}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ú–æ–Ω–æ–ø–æ–ª—ñ–π</div>
                <div class="stat-value">${monopolies.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ë—É–¥–∏–Ω–∫—ñ–≤</div>
                <div class="stat-value">${totalHouses}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ì–æ—Ç–µ–ª—ñ–≤</div>
                <div class="stat-value">${totalHotels}</div>
            </div>
        </div>
    `;
}

// –û—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞–∑–≤—É –≥—Ä—É–ø–∏ –∑–∞ —ó—ó –∫–ª—é—á–µ–º
function getGroupName(groupKey) {
    const groupNames = {
        'brown': '–ö–æ—Ä–∏—á–Ω–µ–≤–∞',
        'lightblue': '–ë–ª–∞–∫–∏—Ç–Ω–∞', 
        'pink': '–†–æ–∂–µ–≤–∞',
        'orange': '–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∞',
        'red': '–ß–µ—Ä–≤–æ–Ω–∞',
        'yellow': '–ñ–æ–≤—Ç–∞',
        'green': '–ó–µ–ª–µ–Ω–∞',
        'blue': '–°–∏–Ω—è'
    };
    return groupNames[groupKey] || groupKey;
}

// –û–Ω–æ–≤–∏—Ç–∏ –≥—Ä—É —ñ –∑–±–µ—Ä–µ–≥—Ç–∏
function updateGameAndSave() {
    updateGame();
    saveGame();
}

// –û–Ω–æ–≤–∏—Ç–∏ –≤—Å—é –≥—Ä—É
function updateGame() {
    renderStreets();
    renderRailroads();
    renderUtilities();
    updateStats();
    populateRentCalculator();
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
window.onload = init;

// –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
window.addEventListener('beforeunload', function(e) {
    saveGame();
});

// –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≤–º—ñ—Å—Ç—É
document.addEventListener('input', function(e) {
    // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø–µ–≤–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
        // –ó–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        setTimeout(saveGame, 1000);
    }
});
</script>
</body>
</html>
